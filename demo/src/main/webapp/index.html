<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="http://dobtco.github.io/jquery-resizable-columns/dist/jquery.resizableColumns.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/store.js/1.3.14/store.min.js"></script>

    <script src="js/ace.js"                type="text/javascript" charset="utf-8"></script>
    <script src="js/mode-java.js"          type="text/javascript" charset="utf-8"></script>
    <script src="js/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>

    <link rel="stylesheet" href="http://dobtco.github.io/jquery-resizable-columns/dist/jquery.resizableColumns.css">
    <link rel="stylesheet" href="css/bootstrap.kinda.su.css" />
    <style>
        .yop-column {
            vertical-align:top;
            text-align:left;
        }
        .ace_editor {
            border: 1px solid lightgray;
            margin: auto;
            height: 100%;
            width: 100%;
        }
    </style>
</head>

<body onload="initEditor();">
    <table
        id="yop_code_table"
        class="table table-bordered"
        data-resizable-columns-id="demo-table"
        style="width:100%;height:600px" >

        <thead>
            <tr style="height:20px">
                <th data-resizable-column-id="about">About this demo</th>
                <th data-resizable-column-id="code">
                    Code your Yopable : <button type="button" onclick="sendCode(editor.getValue());">Submit code</button>
                </th>
                <th data-resizable-column-id="output">Compilation output</th>
            </tr>
        </thead>

        <tbody>
            <tr>
                <td class="yop-column">
                    <div style="">Lorem Ipsum Blah blah</div>
                </td>
                <td class="yop-column" style="height:100%;">
                    <div class="code-window" style="height:100%;">
                      <div id="editor-container">
                        <div id="editor"></div>
                      </div>
                    </div>
                </td>
                <td class="yop-column" style="height:100%;">
                    <div id="compilation-output">
                        <pre id="compilation-output-raw"></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>

    <hr>

    <div>
        <div id="swagger_ui_panel"></div>
    </div>

    <!-- Code editor uses Ace with java language configuration. -->
    <script>
        const editor = ace.edit("editor");

        function initEditor() {
            editor.session.setMode("ace/mode/java");
            document.getElementById('editor').style.fontSize='16px';
            editor.setOptions({
                enableBasicAutocompletion: true
            });
            reset_code();
            editor.resize();
        };
    </script>

    <!-- Send the user code for compilation -->
    <script>
        function sendCode(content) {
            var console_output = $("#compilation-output-raw");
            $("#swagger_ui_panel").html("");
            console_output.html('Compiling <span id="dotdotdot"></span>');
            $.post("yop-demo",content)
            .done(function() {console_output.html("No error :-)"); swagger();})
            .fail(function(xhr) {
                console_output.html(xhr.responseText);
            });
        };
    </script>

    <!--
        Load the Swagger UI for the user code from the /swagger REST resource.
        Every REST request from the swagger-ui will be mapped to a Yop REST resource proxy for the user session
    -->
    <script>
        function swagger() {
            $("#swagger_ui_panel").load("yop-demo/swagger", function(){
                window.onload();
            });
        }
    </script>

    <!-- Reset code editor to default code using a Rest resource â†’ /default_code -->
    <script>
        function reset_code() {
            $.get("yop-demo/default_code", function(data){
                editor.setValue(data);
            });
        }
    </script>

    <!-- dotdotdot for 'Compiling ...' -->
    <script>
        var dots = window.setInterval(
            function() {
                var wait = $("#dotdotdot");
                if (wait.length == 1 && wait.text().length >= 3) {
                    wait.html("");
                } else if (wait.length == 1) {
                    wait.html(wait.text() + ".");
                }
            },
            400
        );
    </script>

    <!-- Resizable columns (and ace code editor) -->
    <script>
        $(function(){
          $("#yop_code_table").resizableColumns({
            store: window.store
          });
          editor.resize();
        });
    </script>
</body>
</html>